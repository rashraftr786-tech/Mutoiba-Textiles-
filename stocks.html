<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stock Management | Mutoiba Textiles</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="nav-bar">
        <strong>Mutoiba Textiles</strong>
        <a href="dashboard.html" style="color: white;">‚Üê Back</a>
    </nav>

    <div style="padding: 1rem; max-width: 800px; margin: auto;">
        <div class="card" style="max-width: 100%; margin-bottom: 20px;">
            <h3>Add New Stock</h3>
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 10px;">
                <input type="text" id="item-name" placeholder="Fabric Name (e.g. Cotton Latha)">
                <input type="number" id="item-qty" placeholder="Yards/Qty">
                <input type="number" id="item-price" placeholder="Price">
                <button id="add-stock-btn">Add</button>
            </div>
        </div>

        <h3>Available Inventory</h3>
        <table style="width: 100%; background: white; border-radius: 8px;">
            <thead style="background: var(--primary); color: white;">
                <tr>
                    <th style="padding: 10px; text-align: left;">Item</th>
                    <th style="padding: 10px;">Qty</th>
                    <th style="padding: 10px;">Price</th>
                </tr>
            </thead>
            <tbody id="stock-list"></tbody>
        </table>
    </div>

    <script type="module">
        import { db } from './js/firebase.js';
        import { collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const stockList = document.getElementById('stock-list');

        async function loadStocks() {
            const querySnapshot = await getDocs(collection(db, "stocks"));
            stockList.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const s = doc.data();
                stockList.innerHTML += `
                    <tr style="border-bottom: 1px solid #eee; text-align: center;">
                        <td style="padding: 10px; text-align: left;">${s.itemName}</td>
                        <td style="padding: 10px;">${s.quantity}</td>
                        <td style="padding: 10px;">Rs. ${s.price}</td>
                    </tr>`;
            });
        }

        document.getElementById('add-stock-btn').onclick = async () => {
            const itemName = document.getElementById('item-name').value;
            const quantity = parseFloat(document.getElementById('item-qty').value);
            const price = parseFloat(document.getElementById('item-price').value);

            await addDoc(collection(db, "stocks"), { itemName, quantity, price, date: serverTimestamp() });
            location.reload();
        };

        loadStocks();
    </script>
</body>
</html>
