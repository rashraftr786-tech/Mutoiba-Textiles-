<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Management | Mutoiba Textiles</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="nav-bar">
        <strong>Mutoiba Textiles</strong>
        <a href="dashboard.html" style="color: white; text-decoration: none;">‚Üê Dashboard</a>
    </nav>

    <div style="padding: 1rem; max-width: 900px; margin: auto;">
        <div class="card" style="max-width: 100%; margin-bottom: 20px;">
            <h3 style="margin-top: 0;">Add/Update Stock</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="item-name" placeholder="Fabric Name" style="flex: 2; min-width: 150px;">
                <input type="number" id="item-qty" placeholder="Quantity (Yards)" style="flex: 1; min-width: 100px;">
                <input type="number" id="item-price" placeholder="Sale Price" style="flex: 1; min-width: 100px;">
                <button id="add-stock-btn" style="flex: 1;">Save Stock</button>
            </div>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; background: white; border-radius: 8px; border-collapse: collapse;">
                <thead style="background: var(--primary); color: white;">
                    <tr>
                        <th style="padding: 12px; text-align: left;">Item Name</th>
                        <th style="padding: 12px;">Available Qty</th>
                        <th style="padding: 12px;">Price/Yard</th>
                        <th style="padding: 12px;">Action</th>
                    </tr>
                </thead>
                <tbody id="stock-list"></tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { db } from './js/firebase.js';
        import { collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const stockList = document.getElementById('stock-list');

        async function loadStocks() {
            const querySnapshot = await getDocs(collection(db, "stocks"));
            stockList.innerHTML = "";
            querySnapshot.forEach((documentSnapshot) => {
                const s = documentSnapshot.data();
                stockList.innerHTML += `
                    <tr style="border-bottom: 1px solid #eee; text-align: center;">
                        <td style="padding: 12px; text-align: left; font-weight: bold;">${s.itemName}</td>
                        <td style="padding: 12px;">${s.quantity} Yards</td>
                        <td style="padding: 12px;">Rs. ${s.price}</td>
                        <td style="padding: 12px;">
                            <button onclick="deleteItem('${documentSnapshot.id}')" style="background: var(--danger); padding: 5px 10px; font-size: 0.7rem;">Delete</button>
                        </td>
                    </tr>`;
            });
        }

        window.deleteItem = async (id) => {
            if(confirm("Delete this item?")) {
                await deleteDoc(doc(db, "stocks", id));
                location.reload();
            }
        };

        document.getElementById('add-stock-btn').onclick = async () => {
            const itemName = document.getElementById('item-name').value;
            const quantity = parseFloat(document.getElementById('item-qty').value);
            const price = parseFloat(document.getElementById('item-price').value);

            if(!itemName || !quantity) return alert("Fill all fields");

            await addDoc(collection(db, "stocks"), { 
                itemName, 
                quantity, 
                price, 
                lastUpdated: serverTimestamp() 
            });
            location.reload();
        };

        loadStocks();
    </script>
</body>
</html>

